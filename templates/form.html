<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Day Matchmaking - Form</title>
    <link rel="stylesheet" href="static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

    <!-- CUPID'S CHOICE iznad header-a -->
    <div class="cupid-choice">CUPID'S CHOICE</div>

    <!-- Header -->
    <header>
        <div class="logo">NLNL25</div>
    </header>

    <main class="main2">
        <div class="content">
           
        </div>
    
        <form id="userForm">
            <label for="ime" class="myLabelStyle">Ime:</label><br>
            <input type="text" id="ime" name="ime" required class="styled-textbox"><br><br>
    
            <label for="prezime" class="myLabelStyle">Prezime:</label><br>
            <input type="text" id="prezime" name="prezime" required class="styled-textbox"><br><br>
    
            <label for="pol" class="myLabelStyle">Pol:</label><br>
            <select id="pol" name="pol" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Muski">Muski</option>
                <option value="Zenski">Zenski</option>
            </select><br><br>
    
            <label for="zeljenipol" class="myLabelStyle">Pol interesa:</label><br>
            <select id="zeljenipol" name="zeljenipol" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Muski">Muski</option>
                <option value="Zenski">Zenski</option>
            </select><br><br>
    
            <label for="tiplicnosti" class="myLabelStyle">Tip Licnosti koji te najbolje opisuje:</label><br>
            <select id="tiplicnosti" name="tiplicnosti" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Ekstrovertan">Ekstrovertan</option>
                <option value="Introvertan">Introvertan</option>
            </select><br><br>
    
            <label for="roleModel" class="myLabelStyle">Licnost koja me najvise inspirise od ponudjenih je:</label><br>
            <select id="roleModel" name="roleModel" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Miljana Kulic">Miljana Kulic</option>
                <option value="Kristijan Golubovic">Kristijan Golubovic</option>
                <option value="Aca Lukas">Aca Lukas</option>
                <option value="Jovana Jeremic">Jovana Jeremic</option>
            </select><br><br>
    
            <label for="zivotnicilj" class="myLabelStyle">Sta od sledeceg bi izdvojio/la kao svoj zivotni cilj:</label><br>
            <select id="zivotnicilj" name="zivotnicilj" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Uspesna karijera">Uspesna karijera</option>
                <option value="Idealna porodica">Idealna porodica</option>
                <option value="Proputovati ceo svet">Proputovati ceo svet</option>
                <option value="Postati poznat">Postati poznat</option>
            </select><br><br>
    
            <label for="zanr" class="myLabelStyle">Omiljeni zanr filmova:</label><br>
            <select id="zanr" name="zanr" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Triler">Triler</option>
                <option value="Horor">Horor</option>
                <option value="Romanticni">Romanticni</option>
                <option value="Komedija">Komedija</option>
            </select><br><br>
    
            <label for="pice" class="myLabelStyle">Odaberi jedno pice:</label><br>
            <select id="pice" name="pice" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Pivo">Pivo</option>
                <option value="Rakija">Rakija</option>
                <option value="Viski">Viski</option>
                <option value="Vodka">Vodka</option>
            </select><br><br>
    
            <label for="hobi" class="myLabelStyle">U slobodno vreme najvise volim da:</label><br>
            <select id="hobi" name="hobi" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Treniram">Treniram</option>
                <option value="Igram igrice">Igram igrice</option>
                <option value="Citam">Citam</option>
                <option value="Izlazim sa drustvom">Izlazim sa drustvom</option>
            </select><br><br>
    
            <label for="pesma" class="myLabelStyle">Odaberi jednu od sledecih pesama:</label><br>
            <select id="pesma" name="pesma" required class="myDropDownStyle">
                <option value="" disabled selected>Izaberi</option>
                <option value="Cakum pakum">Cakum pakum</option>
                <option value="Mangio pasta">Mangio pasta</option>
                <option value="Kukavica">Kukavica</option>
                <option value="Kosi tata, kosim ja">Kosi tata, kosim ja</option>
            </select><br><br>
    
            <button type="submit" class="gumb">Submit</button>
        </form>
    </main>

    <!-- Footer -->
    <footer>
        <p>NAPRAVLJENO S LJUBAVLJU ZA NLNL25 &copy;</p>
    </footer>

    
 
    <script>
document.getElementById("userForm").addEventListener("submit", function(event) {
    event.preventDefault(); // Sprečava default slanje forme

    // Uzimanje vrednosti iz forme
    const formData = {
        ime: document.getElementById("ime").value,
        prezime: document.getElementById("prezime").value,
        pol: document.getElementById("pol").value,
        zeljenipol: document.getElementById("zeljenipol").value,
        tiplicnosti: document.getElementById("tiplicnosti").value,
        roleModel: document.getElementById("roleModel").value,
        zivotnicilj: document.getElementById("zivotnicilj").value,
        zanr: document.getElementById("zanr").value,
        pice: document.getElementById("pice").value,
        hobi: document.getElementById("hobi").value,
        pesma: document.getElementById("pesma").value,
        zauzet: 0,
        par: 0
    };

    // Provera da li su sva polja popunjena
    for (let key in formData) {
        if (formData[key] === "" && key !== "zauzet" && key !== "par") {
            alert("Molim Vas da popunite sva polja.");
            return;
        }
    }

    // Alert za obradu
    Swal.fire({
        title: 'Molim vas ne zatvarajte stranicu, obrada je u toku',
        text: 'Ako je baza opterećena, slanje može potrajati do 1 minut. Molim Vas sačekajte potvrdu o slanju.',
        icon: 'info',
        allowOutsideClick: false,
        showConfirmButton: false,
        didOpen: () => {
            Swal.showLoading();
        }
    });

    // Funkcija za slanje podataka
    function sendData(retryCount = 0) {
        fetch("https://nlnl3.onrender.com/submit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Connection": "keep-alive"
            },
            body: JSON.stringify(formData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Server error: " + response.status);
            }
            return response.json();
        })
        .then(data => {
            Swal.fire({
                title: '✅ Uspeh!',
                text: 'Podaci su uspešno poslati!',
                icon: 'success',
                confirmButtonText: 'U redu'
            }).then(() => {
                localStorage.setItem("userNumber", data.broj);
                window.location.href = "/form2";
            });
        })
        .catch(error => {
            console.error("Greška:", error);
            if (retryCount < 3) {
                setTimeout(() => sendData(retryCount + 1), 2000);  // Retry do 3 puta
            } else {
                Swal.fire({
                    title: '❌ Neuspeh!',
                    text: 'Došlo je do greške prilikom slanja podataka. Pokušajte ponovo kasnije.',
                    icon: 'error',
                    confirmButtonText: 'U redu'
                });
            }
        });
    }

    // Prvi pokušaj slanja podataka
    sendData();
});
</script>


</body>
</html>
