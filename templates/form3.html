<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="static/style.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <title>NO LOVE NO LIFE</title>
</head>
<body>
    <header> 
        <h1>NO LOVE NO LIFE</h1>
    </header>

    <main class="main2">
        <div class="b">
            <h2>Popuni formu i pronadji svoju srodnu dusu!</h2>
            <h3>XOXOXOXO</h3>
        </div>
        
        <!-- Lista koja se popunjava podacima -->
        <ul id="userList"></ul> 
        <table id="dataTable" class = "Table2">
            <thead class = "th1">
                <tr>
                    <th>Par 1</th>
                    <th>Par 2</th>
                </tr>
            </thead>
            <tbody class = "td1">
                <!-- Podaci će biti dodani ovde pomoću JavaScript-a -->
            </tbody>
        </table>
      <script>
      window.onload = function() {
    // Učitaj podatke iz baze putem JSON rute
    fetch('/get_form3_data')  
        .then(response => {
            console.log("Response: ", response);  
            if (!response.ok) {
                throw new Error("Ne mogu da dohvatim podatke");
            }
            return response.json();  // Pretvori JSON odgovor u objekat
        })
        .then(data => {
            console.log("Data: ", data);  
            const userList = data.lista;  // 'lista' je ključ koji sadrži podatke
            const userListElement = document.getElementById('userList');

            if (userList && userList.length > 0) {
                let br = 0;
                const item = userList.map(innerArray => {
                    return innerArray; // Sada je svaka stavka već pravilno formatirana
                });

                // Poređenje parova
                for (let k = 7; k >= 0; k--) {  // Smanjivanje k dok ne nađeš idealne parove
                    for (let i = 0; i < item.length; i++) {
                        if (parseInt(item[i].zauzet) === 1) continue;  // Preskoči zauzete
                        
                        for (let j = i + 1; j < item.length; j++) {
                            if (parseInt(item[j].zauzet) === 1) continue;  // Preskoči zauzete
                            
                            br = 0;
                            // Uporedite različite parametre da biste stvorili parove
                            if (parseInt(item[i].zauzet) === 0 && parseInt(item[j].zauzet) === 0 &&
                                JSON.stringify(item[i].zeljenipol) === JSON.stringify(item[j].pol) &&
                                JSON.stringify(item[i].pol) === JSON.stringify(item[j].zeljenipol)) {

                                // Prolazak kroz sve parametre za slaganje parova
                                if (JSON.stringify(item[i].tiplicnosti) === JSON.stringify(item[j].tiplicnosti)) br++;
                                if (JSON.stringify(item[i].roleModel) === JSON.stringify(item[j].roleModel)) br++;
                                if (JSON.stringify(item[i].zivotnicilj) === JSON.stringify(item[j].zivotnicilj)) br++;
                                if (JSON.stringify(item[i].zanr) === JSON.stringify(item[j].zanr)) br++;
                                if (JSON.stringify(item[i].pice) === JSON.stringify(item[j].pice)) br++;
                                if (JSON.stringify(item[i].hobi) === JSON.stringify(item[j].hobi)) br++;
                                if (JSON.stringify(item[i].pesma) === JSON.stringify(item[j].pesma)) br++;

                                // Ako par zadovoljava kriterijum, označi ih kao zauzete
                                if (br === k) {
                                    item[i].zauzet = item[j].zauzet = 1;  // Označi kao zauzete
                                    item[i].par = item[j].id;  // Par 1
                                    item[j].par = item[i].id;  // Par 2
                                    break;
                                }
                            }
                        }
                    }
                }

                // Prikazivanje podataka u tabeli
                let tableBody = document.getElementById("dataTable").getElementsByTagName("tbody")[0];
                for (let i = 0; i < item.length; i++) {
                    // Ako je item[i].zauzet 0, preskočite taj red
                    if (item[i].zauzet === 0) continue;

                    // Kreiraj novi red za tabelu
                    let row = document.createElement("tr");

                    // Kreiraj ćeliju za item[i].id (prvi element)
                    let cell1 = document.createElement("td");
                    cell1.textContent = item[i].id;
                    row.appendChild(cell1);

                    // Kreiraj ćeliju za item[i].par (par element)
                    let cell2 = document.createElement("td");
                    cell2.textContent = item[i].par;

                    // Proveri da li je `par` vrednost validna
                    if (item[i].par && item[parseInt(item[i].par) - 1]) {
                        item[parseInt(item[i].par) - 1].zauzet = 0; // Resetuj zauzetost za partnera
                    }
                    
                    row.appendChild(cell2);

                    // Dodajte red u telo tabele
                    tableBody.appendChild(row);

                    // Resetovanje statusa zauzetosti za naredne iteracije
                    item[i].zauzet = 0;
                }
            } else {
                const noDataMessage = document.createElement('li');
                noDataMessage.textContent = 'Nema podataka za prikazivanje.';
                userListElement.appendChild(noDataMessage);
            }
        })
        .catch(error => {
            console.error("Greška pri učitavanju podataka:", error);  
        });
}

        </script>

    </main>

    <footer >
        <p class="a"> Napravljeno s ljubavlju za NLNL &#169; 2025 </p>
    </footer>
</body>
</html>
